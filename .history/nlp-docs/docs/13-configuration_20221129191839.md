# Configuration

Commoon configuration process:

- applySettings
- registerDefaults
- apply settings using tag

## BERT Open Question

packages/bert-open-question/src/bert-open-question.js

## Bot

packages/bot/src/bot.js

this.settings.globalFallbackDialog = '/globalFallbackDialog'

| Setting              |       Type        | Description                                                                        |
| :------------------- | :---------------: | :--------------------------------------------------------------------------------- |
| globalFallbackDialog |      String       | Name of the dialog to be executed in case of errors while processing the bot flow  |
| scripts              | String / String[] | Path to the script/s to load by the bot. Can be a single path or an array of paths |

**TODO**: check default validators loaded (see registerDefault method)

## DialogManager

NOTHING HERE

## Test connector

<!-- packages/bot/src/test-connector.js
32,5: this.settings.settings = this.settings.settings || {};
32,30: this.settings.settings = this.settings.settings || {};
61,21: const botName = this.settings.botName || 'bot';
63,9: if (this.settings.debug && typeof message === 'object' && !reference) {
68,9: if (this.settings.settings.trimInput) {
75,22: const userName = this.settings.userName || 'user';
80,23: const name = `${this.settings.tag}.hear`;
91,38: const { conversationId } = this.settings.settings;
131,20: .map((x) => (this.settings.settings.trimInput ? trimInput(x) : x));
156,22: const userName = this.settings.userName || 'user'; -->

## builtin-compromise

NOTHING HERE

## builtin-default

| Setting  |   Type   | Description                                                                                                             |
| :------- | :------: | :---------------------------------------------------------------------------------------------------------------------- |
| builtins | String[] | List of default builtins to load. Defaults to ['Email', 'URL', 'IpAddress', 'PhoneNumber', 'Hashtag', 'Number', 'Date'] |

## builtin-duckling

| Setting     |  Type  | Description                                                                                                                                                                                    |
| :---------- | :----: | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ducklingUrl | String | Duckling service url. Defaults to value in environment variable DUCKLING_URL. In case neither the setting nor the environment variable are provided, defaults to `http://localhost:8000/parse` |

## builtin-microsoft

tag: builtin-microsoft

| Setting          |   Type   | Description                                                                                                                                                                                                                                                                                               |
| :--------------- | :------: | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| builtins         | String[] | List of default builtins to load. Defaults to ['Number', 'Ordinal', 'Percentage', 'Age', 'Currency', 'Dimension', 'Temperature', 'DateTime', 'PhoneNumber', 'IpAddress', 'Boolean', 'Email', 'Hashtag', 'URL']                                                                                            |
| builtinAllowList | String[] | Defaults to [ 'age', 'currency', 'dimension', 'temperature', 'number', 'numberrange', 'ordinal', 'percentage', 'email', 'hashtag', 'ip', 'mention', 'phonenumber', 'url', 'date', 'daterange', 'datetime', 'datetimealt', 'time', 'set', 'timerange', 'timezone', 'boolean', 'duration', 'datetimerange'] |

**TODO** improve documentation about _builtinAllowList_

## connector

NOTHING HERE

## console-connector

packages/console-connector/src/console-connector.js

| Setting | Type | Description |
| :------ | :--: | :---------- |
| botName |      |             |
| debug   |      |             |
| tag     |      |             |

## context

tag: context

| Setting     | Type | Description |
| :---------- | :--: | :---------- |
| storageName |      |             |

## memory-storage

NOTHING HERE

## database

defaults to MemorydbAdapter

default config:

```json
{
  "defaultAdapter": "memory",
  "memory": {
    "autosave": false,
    "autosaveInterval": 0,
    "autosaveFolder": "./"
  }
}
```

**TODO**: explain and split how to configure other adapters (?)

### memory-adapter

tag: memorydb-adapter

| Setting          | Type | Description |
| :--------------- | :--: | :---------- |
| autosave         |      |             |
| autosaveInterval |      |             |
| autosaveFolder   |      |             |

## dialogflow-connector

tag: N/A

| Setting | Type | Description |
| :------ | :--: | :---------- |
| apiTag  |      |             |

## directline-connector

tag: N/A

| Setting         | Type | Description |
| :-------------- | :--: | :---------- |
| autoRemoveFiles |      |             |
| uploadDir       |      |             |
| maxFileSize     |      |             |
| log             |      |             |

When started, loads a directline-controller

### directline-controller

tag: N/A

| Setting    | Type | Description                            |
| :--------- | :--: | :------------------------------------- |
| serviceUrl |      | defaults to env.DIRECTLINE_SERVICE_URL |
| botUrl     |      | defaults to env.DIRECTLINE_BOT_URL     |
| expiresIn  |      | defaults to 1800                       |

### express-api-app

tag: N/A

| Setting    | Type | Description          |
| :--------- | :--: | :------------------- |
| serveBot   |      |                      |
| clientPath |      | defaults to 'public' |
| apiRoot    |      |                      |

## express-api-server

tag: api-server

| Setting | Type | Description |
| :------ | :--: | :---------- |
| apiRoot |      |             |
| port    |      |             |

## express-api-serverless

tag: api-server

| Setting   | Type | Description |
| :-------- | :--: | :---------- |
| apiRoot   |      |             |
| port      |      |             |
| serveBot? |      |             |

packages/fb-connector/src/fb-connector.js
50,24: this.applySettings(this.settings, settings);
51,10: if (!this.settings.tag) {
52,7: this.settings.tag = 'fb';
55,7: this.settings,
56,39: this.container.getConfiguration(this.settings.tag)
96,31: const name = `${this.settings.tag}.hear`;
102,29: const bot = this.settings.container.get('bot');
206,21: let routePath = this.settings.apiPath;
214,24: ? `${routePath}${this.settings.messagesPath || '/api/messages'}`
215,9: : this.settings.messagesPath || '/api/messages';

packages/fullbot/src/fullbot.js
61,5: this.settings = settings || {};
63,7: this.settings.marketUrl || 'https://nlpjsmarket.herokuapp.com/public';
68,9: if (this.settings.port) {
69,44: result.settings['api-server'].port = this.settings.port;
71,9: if (this.settings.scripts) {
72,37: result.settings.bot.scripts = this.settings.scripts;
74,9: if (this.settings.mongoUrl) {
76,48: result.settings['mongodb-adapter'].url = this.settings.mongoUrl;
92,9: if (this.settings.ner && this.settings.ner.ducklingUrl) {
92,30: if (this.settings.ner && this.settings.ner.ducklingUrl) {
93,43: const builtin = new BuiltinDuckling(this.settings.ner);
96,44: const builtin = new BuiltinMicrosoft(this.settings.ner);
99,9: if (this.settings.mongoUrl || process.env.MONGO_URL) {
108,18: let folder = this.settings[`${name}Path`];
109,20: if (!folder && this.settings.botPath) {
110,26: folder = path.join(this.settings.botPath, name);
224,12: dir: this.settings.botPath || './bot',

packages/mongodb-adapter/src/mongodb-adapter.js
38,24: this.applySettings(this.settings, settings);
39,10: if (!this.settings.tag) {
40,7: this.settings.tag = 'mongodb-adapter';
42,10: if (!this.settings.url) {
43,7: this.settings.url = process.env.MONGO_URL;
45,10: if (!this.settings.dbName && this.settings.url) {
45,34: if (!this.settings.dbName && this.settings.url) {
46,7: this.settings.dbName = this.settings.url.slice(
46,30: this.settings.dbName = this.settings.url.slice(
47,9: this.settings.url.lastIndexOf('/') + 1
50,40: this.mongoClient = new MongoClient(this.settings.url, {

packages/msbf-connector/src/msbf-connector.js
38,24: this.applySettings(this.settings, settings);
39,10: if (!this.settings.tag) {
40,7: this.settings.tag = 'msbf';
43,7: this.settings,
44,39: this.container.getConfiguration(this.settings.tag)
54,14: appId: this.settings.appId || process.env.MSBF_BOT_APP_ID,
56,9: this.settings.botPassword || process.env.MSBF_BOT_APP_PASSWORD,
61,21: let routePath = this.settings.apiPath;
69,24: ? `${routePath}${this.settings.messagesPath || '/api/messages'}`
70,9: : this.settings.messagesPath || '/api/messages';
90,31: const name = `${this.settings.tag}.hear`;
95,29: const bot = this.settings.container.get('bot');

packages/ner/src/ner.js
45,24: this.applySettings(this.settings, settings);
46,24: this.applySettings(this.settings);
47,10: if (!this.settings.tag) {
48,7: this.settings.tag = `ner`;
52,7: this.settings,
53,39: this.container.getConfiguration(this.settings.tag)
57,44: pipelineProcess: this.getPipeline(`${this.settings.tag}-process`),
392,32: const input = { threshold: this.settings.threshold || 0.8, ...srcInput };
396,12: `${this.settings.tag}-${input.locale}-process`
413,7: this.settings.entityPreffix === undefined
415,11: : this.settings.entityPreffix;
417,7: this.settings.entitySuffix === undefined
419,11: : this.settings.entitySuffix;
429,7: this.settings.entityPreffix === undefined
431,11: : this.settings.entityPreffix;
433,7: this.settings.entitySuffix === undefined
435,11: : this.settings.entitySuffix;
503,22: settings: { ...this.settings },
512,24: this.applySettings(this.settings, json.settings);

packages/neural/src/neural-network.js
38,5: this.settings = settings;
39,24: this.applySettings(this.settings, defaultSettings);
40,9: if (this.settings.log === true) {
45,23: } else if (typeof this.settings.log === 'function') {
46,20: this.logFn = this.settings.log;
84,27: return sum <= 0 ? 0 : this.settings.alpha _ sum;
119,33: const { alpha, momentum } = this.settings;
172,22: const minError = this.settings.errorThresh;
173,22: const minDelta = this.settings.deltaErrorThresh;
175,32: this.status.iterations < this.settings.iterations &&
182,9: this.settings.learningRate / (1 + 0.001 _ this.status.iterations);
218,30: const keys = Object.keys(this.settings);
221,11: if (this.settings[key] !== defaultSettings[key]) {
222,25: settings[key] = this.settings[key];
247,5: this.settings = this.applySettings({

packages/nlg/src/action-manager.js
42,24: this.applySettings(this.settings, settings);
43,10: if (!this.settings.tag) {
44,7: this.settings.tag = 'action-manager';
48,7: this.settings,
49,39: this.container.getConfiguration(this.settings.tag)
54,41: pipelineFind: this.getPipeline(`${this.settings.tag}-find`),
183,52: input.settings = input.settings || settings || this.settings;
189,22: settings: { ...this.settings },
197,24: this.applySettings(this.settings, json.settings);

packages/nlg/src/nlg-manager.js
35,24: this.applySettings(this.settings, settings);
36,10: if (!this.settings.tag) {
37,7: this.settings.tag = 'nlg-manager';
41,7: this.settings,
42,39: this.container.getConfiguration(this.settings.tag)
46,41: pipelineFind: this.getPipeline(`${this.settings.tag}-find`),
203,29: settings: settings || this.settings,
222,22: settings: { ...this.settings },
230,24: this.applySettings(this.settings, json.settings);

packages/nlp/src/context-manager.js
34,24: this.applySettings(this.settings, settings);
35,10: if (!this.settings.tag) {
36,7: this.settings.tag = `context-manager`;
40,7: this.settings,
41,39: this.container.getConfiguration(this.settings.tag)
72,11: if (this.settings.tableName) {
77,44: result = (await database.findOne(this.settings.tableName, {
110,11: if (this.settings.tableName) {
115,31: await database.save(this.settings.tableName, clone);

packages/nlp/src/nlp.js
47,24: this.applySettings(this.settings, settings);
48,10: if (!this.settings.tag) {
49,7: this.settings.tag = `nlp`;
53,7: this.settings,
54,39: this.container.getConfiguration(this.settings.tag)
56,57: this.nluManager = this.container.get('nlu-manager', this.settings.nlu);
57,42: this.ner = this.container.get('ner', this.settings.ner);
58,57: this.nlgManager = this.container.get('nlg-manager', this.settings.nlg);
61,7: this.settings.action
65,7: this.settings.sentiment
67,58: this.slotManager = this.container.get('SlotManager', this.settings.slot);
70,7: this.settings.context
72,21: this.forceNER = this.settings.forceNER;
105,9: if (this.settings.nlu) {
106,35: const locales = Object.keys(this.settings.nlu);
109,37: const domains = Object.keys(this.settings.nlu[locale]);
112,28: const settings = this.settings.nlu[locale][domain];
119,9: if (this.settings.languages) {
120,24: this.addLanguage(this.settings.languages);
122,9: if (this.settings.locales) {
123,24: this.addLanguage(this.settings.locales);
125,9: if (this.settings.calculateSentiment === undefined) {
126,7: this.settings.calculateSentiment = true;
131,9: if (this.settings.corpora) {
132,29: await this.addCorpora(this.settings.corpora);
138,9: if (this.settings.autoLoad) {
139,32: loaded = await this.load(this.settings.modelFileName);
472,33: this.nluManager.addLanguage(this.settings.languages);
474,9: if (this.settings.autoSave) {
475,23: await this.save(this.settings.modelFileName, true);
484,19: settings || this.settings.nlu
503,46: settings: this.applySettings(settings, this.settings.ner),
587,46: settings: this.applySettings(settings, this.settings.nlu),
604,50: settings: this.applySettings(settings, this.settings.nlu),
617,24: if (output.score < this.settings.threshold) {
652,9: if (this.settings.calculateSentiment) {
699,22: settings: { ...this.settings },
712,24: this.applySettings(this.settings, json.settings);

packages/nlu/src/domain-manager.js
37,24: this.applySettings(this.settings, settings);
38,24: this.applySettings(this.settings, { locale: 'en' });
39,10: if (!this.settings.tag) {
40,7: this.settings.tag = `domain-manager-${this.settings.locale}`;
40,45: this.settings.tag = `domain-manager-${this.settings.locale}`;
44,7: this.settings,
45,39: this.container.getConfiguration(this.settings.tag)
53,42: pipelineTrain: this.getPipeline(`${this.settings.tag}-train`),
54,44: pipelineProcess: this.getPipeline(`${this.settings.tag}-process`),
87,10: if (!this.settings.nluByDomain) {
88,7: this.settings.nluByDomain = {};
90,28: const domainSettings = this.settings.nluByDomain[domainName] ||
91,7: this.settings.nluByDomain.default || {
98,19: { locale: this.settings.locale },
204,7: this.settings.trainByDomain ? undefined : defaultDomainName
247,41: const options = { useNoneFeature: this.settings.useNoneFeature };
261,29: settings: settings || this.settings,
300,64: const settings = this.applySettings({ ...input.settings }, this.settings);
330,27: input.settings || this.settings
358,9: this.settings.trainByDomain) ||
395,35: settings: settings || this.settings,
406,17: settings: this.settings,
421,24: this.applySettings(this.settings, json.settings);

packages/nlu/src/nlu-manager.js
37,24: this.applySettings(this.settings, settings);
38,10: if (!this.settings.tag) {
39,7: this.settings.tag = 'nlu-manager';
43,7: this.settings,
44,39: this.container.getConfiguration(this.settings.tag)
54,9: if (this.settings.locales) {
55,24: this.addLanguage(this.settings.locales);
58,42: pipelineTrain: this.getPipeline(`${this.settings.tag}-train`),
59,44: pipelineProcess: this.getPipeline(`${this.settings.tag}-process`),
88,18: ...this.settings.domain,
89,31: useNoneFeature: this.settings.useNoneFeature,
90,30: trainByDomain: this.settings.trainByDomain,
233,46: settings: this.applySettings(settings, this.settings),
323,35: settings: settings || this.settings,
333,17: settings: this.settings,
350,24: this.applySettings(this.settings, json.settings);

packages/nlu/src/nlu.js
36,24: this.applySettings(this.settings, settings);
37,24: this.applySettings(this.settings, { locale: 'en' });
38,10: if (!this.settings.tag) {
39,7: this.settings.tag = `nlu-${this.settings.locale}`;
39,34: this.settings.tag = `nlu-${this.settings.locale}`;
43,7: this.settings,
44,39: this.container.getConfiguration(this.settings.tag)
47,44: pipelinePrepare: this.getPipeline(`${this.settings.tag}-prepare`),
48,42: pipelineTrain: this.getPipeline(`${this.settings.tag}-train`),
49,44: pipelineProcess: this.getPipeline(`${this.settings.tag}-process`),
51,38: this.spellCheck = new SpellCheck(this.settings);
130,37: const settings = srcSettings || this.settings;
133,17: locale: this.settings.locale,
172,60: const settings = this.applySettings(srcSettings || {}, this.settings);
388,11: : this.settings.nonedeltaValue;
392,20: nonedelta \*= this.settings.nonedeltaMultiplier;
408,46: settings: this.applySettings(settings, this.settings),
442,52: settings: this.applySettings(settings || {}, this.settings),
469,22: settings: { ...this.settings },
480,24: this.applySettings(this.settings, json.settings);

packages/nlu-luis/src/nlu-luis.js
36,7: this.settings.useStemmer && input.tokens
39,40: input.nluAnswer = await request(`${this.settings.luisUrl}${text}`);
44,23: return request(`${this.settings.luisUrl}${utterance}`);

packages/node-nlp/src/nlp/nlp-manager.js
38,5: this.settings = settings;
39,10: if (!this.settings.container) {
40,7: this.settings.container = containerBootstrap();
42,22: this.container = this.settings.container;
52,24: this.nlp = new Nlp(this.settings);
54,9: if (this.settings.ner) {
55,11: if (this.settings.ner.ducklingUrl || this.settings.ner.useDuckling) {
55,44: if (this.settings.ner.ducklingUrl || this.settings.ner.useDuckling) {
56,45: const builtin = new BuiltinDuckling(this.settings.ner);
59,46: const builtin = new BuiltinMicrosoft(this.settings.ner);
63,44: const builtin = new BuiltinMicrosoft(this.settings.ner);
102,12: fn = this.settings.action ? this.settings.action[action] : undefined;
102,35: fn = this.settings.action ? this.settings.action[action] : undefined;
212,9: if (this.settings.processTransformer) {
213,14: return this.settings.processTransformer(result);

packages/node-nlp/src/nlu/brain-nlu.js
30,5: this.settings = settings;
31,10: if (!this.settings.container) {
32,7: this.settings.container = containerBootstrap();
34,22: this.container = this.settings.container;
36,10: if (!this.settings.l)
38,17: locale: this.settings.locale || this.settings.language || 'en',
38,41: locale: this.settings.locale || this.settings.language || 'en',
54,40: return this.nlu.train(this.corpus, this.settings);

packages/node-nlp/src/recognizer/conversation-context.js
37,5: this.settings = settings || {};

packages/node-nlp/src/recognizer/recognizer.js
36,5: this.settings = settings || {};
38,7: this.settings.nlpManager ||
40,20: container: this.settings.container,
41,27: ner: { threshold: this.settings.nerThreshold || 1 },
43,22: this.threshold = this.settings.threshold || 0.7;
45,7: this.settings.conversationContext || new MemoryConversationContext();

packages/node-nlp/src/sentiment/sentiment-manager.js
35,5: this.settings = settings || {};
74,7: this.settings

packages/open-question/src/qa-client.js
30,5: this.settings = settings;
34,37: const settings = srcSettings || this.settings;

packages/open-question/src/runtime.js
30,5: this.settings = settings;
46,49: await tf.node.getMetaGraphsFromSavedModel(this.settings.path)
48,41: this.params = Runtime.computeParams(this.settings, modelGraph);

packages/rest-connector/src/rest-connector.js
37,9: if (this.settings.log) {
47,10: if (!this.settings.apiTag) {
48,7: this.settings.apiTag = '/rest';
51,19: server.get(`${this.settings.apiTag}/token`, async (req, res) => {
52,32: this.log('debug', `GET ${this.settings.apiTag}/token`);
68,19: server.get(`${this.settings.apiTag}/talk`, async (req, res) => {
69,32: this.log('debug', `GET ${this.settings.apiTag}/talk`);

packages/sentiment/src/sentiment-analyzer.js
35,24: this.applySettings(this.settings, settings);
36,10: if (!this.settings.tag) {
37,7: this.settings.tag = 'sentiment-analyzer';
41,7: this.settings,
42,39: this.container.getConfiguration(this.settings.tag)
45,44: pipelinePrepare: this.getPipeline(`${this.settings.tag}-prepare`),
46,44: pipelineProcess: this.getPipeline(`${this.settings.tag}-process`),
55,42: const pipeline = this.getPipeline(`${this.settings.tag}-prepare`);
60,31: settings: settings || this.settings,
200,52: input.settings = input.settings || settings || this.settings;

packages/similarity/src/spell-check.js
28,5: this.settings = settings || {};
29,22: this.minLength = this.settings.minLength || 4;
30,9: if (this.settings.features) {
31,24: this.setFeatures(this.settings.features);

packages/similarity-wa/src/spell-check.js
28,5: this.settings = settings || {};
29,22: this.minLength = this.settings.minLength || 4;
30,9: if (this.settings.features) {
31,24: this.setFeatures(this.settings.features);

packages/utils/src/nlp-analyzer.js
29,5: this.settings = settings;
31,7: this.settings.threshold === undefined ? 0.5 : this.settings.threshold;
31,53: this.settings.threshold === undefined ? 0.5 : this.settings.threshold;
